![输入图片说明](./src/img/images/06693fe2_4993153.png "")

> ## WARNING
> 在最新版的Chrome浏览器（以及所有以Chromium为内核的浏览器）中，已不再允许自动播放音频和视频。就算你为video或audio标签设置了autoplay属性也一样不能自动播放。

 **修改思路：** 先静音播放，页面出发播放时取消静音；

``` Html
  <!--声音播放-->
  <div style="display: none;">
    <video id="audioId" name="media" hidden muted>
      <source src="" type="audio/mp3">
    </video>
  </div>
```

``` TypeScript
  private voiceOn() {
    $("#audioId").attr("src", "app/modules/WarnPopup/text2audio.mp3");
    let myvoice: any = $("#audioId")[0];
    myvoice.muted = false;
    myvoice.play();
    // 循环播放三次
    let num = 0;
    myvoice.addEventListener("ended", () => {
      if (num == 2) {
        myvoice.pause();
        return
      }
      num = num + 1;
      myvoice.play();
    });
  }
```


# VUE

``` TypeScript
import alarmSound from '@/assets/image/warning/text2audio.mp3'

const audio = ref(null) as any  //audio对象
const playCount = ref(0)
const maxPlayCount = ref(3) // 最大播放次数
const soundState = ref(false) // true为开启状态，false关闭状态

// 开启声音
const controlSound = async () => {
  if (soundState.value) {
    pause()
  } else {
    play()
  }
}
const play = () => {
  if (playCount.value >= maxPlayCount.value) return
  if (!audio.value) {
    audio.value = new Audio(alarmSound);
    audio.value.addEventListener('ended', handleEnded)
  }
  audio.value.play()
  soundState.value = true
}
const pause = () => {
  if (audio.value) {
    audio.value.pause()
    audio.value.currentTime = 0
    soundState.value = false
  }
}
// 处理声音播放结束后事件，播放三次后停止
const handleEnded = () => {
  playCount.value++;
  if (playCount.value < maxPlayCount.value) {
    audio.value.play()
  } else {
    pause()
    playCount.value = 0
    audio.value.addEventListener('ended', handleEnded)
  }
}
```
